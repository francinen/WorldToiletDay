var toiletApp={},apiID="ae14015e",apiKey="e0c56e76772fe67b98846adfc6c09565",$countriesList=$("select.countries"),arrCountryNames=[],inputVariants={Antigua:"Antigua%20and%20Barbuda",Barbuda:"Antigua%20and%20Barbuda",Bolivia:"Bolivia%20(Plurinational%20State%20of)",Bosnia:"Bosnia%20and%20Herzegovina",Herzegovina:"Bosnia%20and%20Herzegovina","North Korea":"Democratic%20People's%20Republic of Korea",Iran:"Iran%20(Islamic%20Republic%20of)",Laos:"Lao%20People's%20Democratic%20Republic",Micronesia:"Micronesia%20(Federated%20States%20of)",Moldova:"Republic%20of%20Moldova",Syria:"Syrian%20Arab%20Republic",Vietnam:"Viet%20Nam","The Philippines":"Philippines",Russia:"Russian%20Federation",USA:"United%20States%20of%20America",Tanzania:"United%20Republic%20of%20Tanzania",Yugoslavia:"The%20former%20Yugoslav%20Republic%20of%20Macedonia",UAE:"United%20Arab%20Emirates",Venezuela:"Venezuela%20(Bolivarian%20Republic%20of)"},$chart=$(".chart").find("canvas"),$hideAll=$("div.one, div.two, div.three, div#pageLoad, div#dataLoad, div.default, div.dataInfo"),$dataLoader=$("div#dataLoad"),$error=$("div.error"),$countryData=$("section.countryData"),$input=$("#searchCountry"),tl=new TimelineLite;toiletApp.init=function(){toiletApp.getCountries()},toiletApp.pageLoad=function(){function e(t){tl.to($("#poop1"),t,{rotation:"+=360"}).to($("#poop2"),t,{rotation:"+=360"}).to($("#poop3"),t,{rotation:"+=360",onComplete:function(){e(t)}})}TweenMax.staggerFrom("header span",.6,{top:-20,autoAlpha:0},.1),$("#pageLoad").fadeIn(900),e(.9)},toiletApp.initialLoad=function(){tl.to($("form"),.4,{top:0,autoAlpha:1}).to($countryData,.8,{top:0,autoAlpha:1}).to($("footer"),.8,{top:0,autoAlpha:1})},toiletApp.dataLoad=function(){function e(t){TweenLite.to($("#flush"),t,{rotation:"+=360",ease:Linear.easeNone,onComplete:function(){e(t)}})}$(".content").css("opacity",.6),$dataLoader.show(),e(1.6)},toiletApp.displayData=function(){$(".dial").knob({readOnly:!0,width:"90%",thickness:".25",fgColor:"#8a6755",bgColor:"#a2af9f"})},toiletApp.getCountries=function(){$.ajax({url:"http://api.undata-api.org/WHO/Proportion%20of%20population%20using%20improved%20sanitation%20facilities/countries?app_id="+apiID+"&app_key="+apiKey,type:"GET",dataType:"json",beforeSend:function(){toiletApp.pageLoad()},error:function(){$hideAll.hide(),$countryData.css("visibility","visible"),$(".content").css("opacity",1),$error.show(),$("#errorMessage").text("Unable to access database."),$("#action").text("Please try again later.")},success:function(e){setTimeout(function(){for(var t=0;t<e.length;t++)arrCountryNames.push(e[t].name);arrCountryNames=arrCountryNames.sort(),console.log(arrCountryNames),$input.autocomplete({source:arrCountryNames,minLength:2}),toiletApp.getCountryData(arrCountryNames),$("#pageLoad").fadeOut(500),toiletApp.initialLoad()},1300)}})},toiletApp.autoComplete=function(e){$input.autocomplete({source:e,minLength:2}).attr("autocomplete","on")},toiletApp.ajaxRequest=function(e,t,a){$.ajax({url:"http://api.undata-api.org/WHO/Proportion%20of%20population%20using%20improved%20sanitation%20facilities/"+e+"/records?app_id="+t+"&app_key="+a,type:"GET",dataType:"json",beforeSend:function(){toiletApp.dataLoad()},error:function(){$hideAll.hide(),$error.show(),$("#errorMessage").text("Unable to access database."),$("#action").text("Please try again later.")},success:function(e){setTimeout(function(){$(".chart").empty(),toiletApp.parseCountryData(e),$dataLoader.hide(),$(".content").css("opacity",1)},500)}})},toiletApp.randomCountry=function(e,t,a,o){var i=Math.floor(Math.random()*e.length);t=e[i],t.match(/\s/g)?(t=t.replace(/\s/g,"%20"),toiletApp.ajaxRequest(t,a,o)):toiletApp.ajaxRequest(t,a,o)},toiletApp.evalCountryName=function(e){selected=document.querySelector("#searchCountry"),country=selected.value,country=country.replace(country.charAt(0),country.charAt(0).toUpperCase()),e.hasOwnProperty(country)?toiletApp.ajaxRequest(e[country],apiID,apiKey):toiletApp.userInput(arrCountryNames,country)},toiletApp.userInput=function(e,t){-1==e.indexOf(t)?($hideAll.hide(),$error.show(),$(".content").css("opacity",1),$("#errorMessage").text("Looks like "+t+" isn't included in the database."),$("#action").text("Please search for another country.")):t.match(/\s/g)?(t=selected.value.replace(/\s/g,"%20"),toiletApp.ajaxRequest(t,apiID,apiKey)):toiletApp.ajaxRequest(t,apiID,apiKey),$.smoothScroll({scrollTarget:".mainSearch",speed:600})},toiletApp.getCountryData=function(){$("#searchButton").on("click",function(){toiletApp.evalCountryName(inputVariants)}),$(".ui-autocomplete").on("click keydown","li",function(){console.log("I work!"),toiletApp.dataLoad(),toiletApp.evalCountryName(inputVariants)}),$input.on("keydown",function(e){13==e.keyCode&&(toiletApp.dataLoad(),toiletApp.evalCountryName(inputVariants),$(".ui-autocomplete").hide())})},toiletApp.showOne=function(e,t,a,o){i=0,$("div.dataInfo, div.one").show(),$("div.three, div.two").hide(),$("div.error, div.default").hide(),$("#area .chart").prepend(o),toiletApp.displayData(),$("#area").find(".percent").text(a),$(".area").text(e[i]["residence area"].toLowerCase())},toiletApp.showTwo=function(){$("div.dataInfo, div.two").show(),$("div.three, div.one").hide(),$("div.error, div.default").hide()},toiletApp.showThree=function(e,t,a,o,i){$("div.dataInfo, div.three").show(),$("div.one, div.two").hide(),$("div.error, div.default").hide(),$("#"+i+" .chart").prepend(o),toiletApp.displayData(),$("#"+i).find(".percent").text(a),0==a?$(".universal").show():$(".universal").hide()},toiletApp.evalData=function(e,t,a,o,i){$chart=$("<input>").addClass("dial").attr({type:"text",value:a}),console.log(e,t,a,i),0===e?t===o[1]["residence area"]&&t===o[2]["residence area"]?(toiletApp.showOne(o,t,a,$chart),console.log("Match!"),console.log(o[1]["residence area"]),console.log(o[2]["residence area"])):t===o[2]["residence area"]?(toiletApp.showTwo(),$("#area1 .chart").prepend($chart),toiletApp.displayData(),$("#area1").find(".percent").text(a),$("#area1").find(".area").text(t)):t!==o[2]["residence area"]&&t!==o[1]["residence area"]&&(toiletApp.showThree(o,t,a,$chart,i),console.log("No match!")):1===e?o[0]["residence area"]==o[2]["residence area"]&&t!=o[0]["residence area"]?(toiletApp.showTwo(),$("#area2 .chart").prepend($chart),toiletApp.displayData(),$("#area2").find(".percent").text(a),$("#area2").find(".area").text(t)):toiletApp.showThree(o,t,a,$chart,i):2===e&&(2006!=o[2].year?(toiletApp.showOne(o,t,a,$chart),console.log("The year is "+o[2].year)):(toiletApp.showThree(o,t,a,$chart,i),console.log("No matches!")))},toiletApp.parseCountryData=function(e){if(2006!=e[2].year&&2006!=e[1].year&&2006!=e[0].year)$hideAll.hide(),$error.show(),$(".content").css("opacity",1),$("#errorMessage").text("Sorry, there's not enough data about "+e[2].area_name+"."),$("#action").text("Please search for another country.");else{var t=e[0].area_name;for(console.log(t),$("#countryName").text("Philippines"==t?"The "+t:"Viet Nam"==t?"Vietnam":t),i=2;i>=0;i--)area=e[i]["residence area"],percent=100-e[i].value,e.length>=3?"Total"===area?toiletApp.evalData(i,area,percent,e,"total"):"Rural"===area?toiletApp.evalData(i,area,percent,e,"rural"):"Urban"===area&&toiletApp.evalData(i,area,percent,e,"urban"):($hideAll.hide(),$error.show(),$(".content").css("opacity",1),$("#errorMessage").text("Sorry, there's not enough data about "+e[2].area_name+"."),$("#action").text("Please search for another country."))}},$(function(){$("body").on("click","button",function(e){e.preventDefault()}),toiletApp.init()});